<html>
<head>
    <style>

        body {
            flex-direction: column;
            display: flex;
            justify-content: flex-start;
        }

        .col {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid;
            width: 50px;
            flex-direction: column;
        }

        .coordinates {
            font-size: 11px;
            flex: auto;
        }

        .row {
            display: flex;
            flex-direction: row;
            height: 100px;
        }

        .player1_piece {
            background-color: blue;
        }

        .player2_piece {
            background-color: green;
        }

        .player3_piece {
            background-color: red;
        }

        .player4_piece {
            background-color: yellow;
        }

        .player5_piece {
            background-color: cadetblue;
        }

        .player6_piece {
            background-color: burlywood;
        }

        .player7_piece {
            background-color: darkcyan;
        }

        .piece {
            float: left;
            width: 10px;
        }

        .action {
            width: 100%;
            height: 100%;
            background: url('http://icons.iconarchive.com/icons/icons8/windows-8/256/Military-Sword-icon.png') no-repeat center;
            background-size: 10px;
        }
    </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="stomp.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
    function connect() {
        var socket = new SockJS('/gs-guide-websocket');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, function (frame) {
            console.log('Connected: ' + frame);
            stompClient.subscribe('/topic/board', function (data) {
                render(data.body);
            });
            stompClient.subscribe('/topic/status', function (data) {
                console.log(data.body);
            });
        });
    }

    function render(fields) {
        var allFields = JSON.parse(fields);
        var render = '';
        var iter = 0;
        var itemsPerRow = Math.sqrt(allFields.length);
        for (var i = 0; i < allFields.length; i++) {
            if (iter === 0) {
                render += "<div class='row'>";
            }
            render +=
                "<div class='col'>" +
                "<div class='coordinates'>" + extractMeta(allFields[i].position) + "</div>" +
                "<div class='pieces'>" + extractPieces(allFields[i].pieces) + "</div>" +
                extractAction(allFields[i].action) +
                "</div>";
            if (iter === itemsPerRow - 1) {
                render += "</div>";
                iter = -1;
            }
            iter++;
        }
        document.getElementsByTagName('body')[0].innerHTML = render;
    }

    function extractMeta(position) {
        return '[' + position.data.x + ':' + position.data.y + ']';
    }

    function extractPieces(pieces) {
        var result = '';
        if (pieces && pieces.length > 0) {
            for (var i = 0; i < pieces.length; i++) {
                result += "<div class='piece " + pieces[i].name + "'>&nbsp;</div>";
            }
        }
        return result;
    }

    function extractAction(action) {
        var result = '';
        if (action) {
            result += "<div class='action'>&nbsp;</div>";
        }
        return result;
    }

    connect();

</script>
</body>
</html>